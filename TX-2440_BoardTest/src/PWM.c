#include "2440addr.h"#include "2440lib.h"#include "def.h"#include "uart.h"#include "PWM.h"extern unsigned int PCLK;//====================================================// 语法格式：void Buzzer_Freq_Set(U32 freq)// 功能描述: 设置蜂鸣器频率函数// 入口参数: freq// 出口参数: 无//====================================================void Buzzer_Freq_Set(U32 freq){	rGPBCON &= ~3;			//设置GPB口 B0为TOUT0输出 PWM输出管脚	rGPBCON |= 2;			rTCFG0 &= ~0xff;	rTCFG0 |= 15;			//prescaler = 15+1  timer0的时钟频率为50M/16 = 3.125MHz	rTCFG1 &= ~0xf;	rTCFG1 |= 2;			//mux = 1/8   timer0的时钟频率为50M/16/8 = 0.39MHz	rTCNTB0 = (PCLK>>7)/freq;  //设置timer0初值	rTCMPB0 = rTCNTB0>>1;	// 50%	rTCON &= ~0x1f;	rTCON |= 0xb;			//自动重载, 反向关闭, 手动刷新, 启动timer0	rTCON &= ~2;			//clear manual update bit}//====================================================// 语法格式：void Buzzer_Stop(void)// 功能描述: 停止蜂鸣器发声函数// 入口参数: 无// 出口参数: 无//====================================================void Buzzer_Stop(void){	rGPBCON &= ~3;	rGPBCON |= 1;	rGPBDAT &= ~1;}void Test_PWM(void){	U16 freq =800;  //默认频率为800;		Uart_Printf("\nBUZZER TEST ( PWM Control )\n");   	Uart_Printf("Press +/- to increase/reduce the frequency of BUZZER !\n");	Uart_Printf("Press 'ESC' key to Exit this program !\n\n");		Buzzer_Freq_Set(freq);    while(1)    {		U8 key = Uart_ReceiveByte();		if(key == '+')		{			if(freq < 2000)  //最大频率为2000				freq += 10;							Buzzer_Freq_Set(freq);		}		if(key == '-')		{			if(freq > 11)				freq -= 10;							Buzzer_Freq_Set(freq);		}				Uart_Printf("\tFreq = %d\n", freq);		if(key == ESC_KEY)		{			Buzzer_Stop();			Uart_Printf("BUZZER TEST STOP\n");			return;		}	}}